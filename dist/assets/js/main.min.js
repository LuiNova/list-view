"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}requirejs.config({baseUrl:"src/javascript",paths:{app:"../dist"}}),requirejs(["main"],function(t){t.init()}),define("main",["components/infinite-scroller","components/infinite-scroller-experimental","datasource/messages"],function(t,e,s){return{init:function(){var i=document.querySelector("#messages"),a=document.querySelector("#messages-exp"),r=new s({url:"https://message-list.appspot.com",dataEndpoint:"/messages"});i&&(this.infiniteScroller=new t(i,r,{swipeable:!0})),a&&(this.infiniteScrollerExp=new e(a,r,{swipeable:!0}))}}});var _createClass=function(){function t(t,e){for(var s=0;s<e.length;s++){var i=e[s];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,s,i){return s&&t(e.prototype,s),i&&t(e,i),e}}();define("components/infinite-scroller-experimental",[],function(){var t=20,e=300;return function(){function s(i,a,r){_classCallCheck(this,s),this.scroller=i,this.dataSource=a,this.swipeable=r.swipeable,this.PHYSICAL_ITEMS=r.physicalItems||t,this.PAGE_SIZE=r.pageSize||10,this.PROXIMITY_BOUNDARY=r.proximityBoundary||e,this.itemsCacheData=[],this.loadingItemHeight=0,this.loadingItemWidth=0,this.loadingItems=[],this.physicalItems=[],this.firstPhysicalItemIndex=-1,this.middlePhysicalItemIndex=-1,this.lastPhysicalItemIndex=-1,this.firstPhysicalItem=null,this.lastPhysicalItem=null,this.firstPhysicalItemTranslateY=0,this.lastPhysicalItemTranslateY=0,this.requestInProgress=!1,this.target=null,this.targetBCR=null,this.targetX=0,this.startX=0,this.currentX=0,this.translateX=0,this.draggingItem=!1,this.scrollRunway=document.createElement("div"),this.scrollRunwayEndBefore=0,this.scrollRunwayEnd=0,this.scrollRunway.style.position="absolute",this.scrollRunway.style.height="1px",this.scrollRunway.style.width="1px",this.scrollRunway.style.transition="transform 0.2s",this.scroller.appendChild(this.scrollRunway),this.previousScrollTop=0,this.addEventListeners(),this.count=0,this.onResize(),this.loadItems()}return _createClass(s,[{key:"addEventListeners",value:function(){var t=this;window.addEventListener("resize",function(e){return t.onResize(e)}),this.scroller.addEventListener("scroll",function(e){return t.onScroll(e)}),this.swipeable&&(this.scroller.addEventListener("touchstart",function(e){return t.onTouchStart(e)}),this.scroller.addEventListener("touchmove",function(e){return t.onTouchMove(e)}),this.scroller.addEventListener("touchend",function(e){return t.onTouchEnd(e)}))}},{key:"onResize",value:function(t){var e=this.dataSource.createLoadingElement();this.scroller.appendChild(e),this.loadingItemHeight=e.offsetHeight,this.loadingItemWidth=e.offsetWidth,this.scroller.removeChild(e)}},{key:"onScroll",value:function(s){if(!this.requestInProgress){var i=this.scroller.scrollTop-this.previousScrollTop;if(this.previousScrollTop=this.scroller.scrollTop,i>0){if(this.requestInProgress)return;var a=this.lastPhysicalItemIndex%t,r=(++this.physicalItems[a].dataset.translateY,this.lastPhysicalItemTranslateY-(this.lastPhysicalItem.offsetHeight+10)-(this.scroller.scrollTop+this.scroller.offsetHeight));!this.requestInProgress&&r<e&&this.loadItems()}else if(i<0){if(this.requestInProgress)return;var n=this.firstPhysicalItemIndex%t,l=(++this.physicalItems[n].dataset.translateY,this.lastPhysicalItemIndex-t+1),h=l*(this.loadingItemHeight+10),o=this.scroller.scrollTop-h;!this.requestInProgress&&0!==this.firstPhysicalItemIndex&&o<e&&this.loadItemsUp()}}}},{key:"loadItems",value:function(){var t=this;this.requestInProgress=!0;for(var e=this.scrollRunwayEnd,s=0;s<10;s+=1){var i=this.loadingItems[s],a=i?this.loadingItems[s]:this.dataSource.createLoadingElement();this.loadingItems[s]=a,a.style.position="absolute",a.style.transform="translateY("+e+"px)",a.style.width="92%",a.classList.remove("invisible"),i||this.scroller.appendChild(a),e+=this.loadingItemHeight+10}var r=this.lastPhysicalItemIndex+1;this.itemsCacheData[r]?this.populateItems(this.itemsCacheData.slice(r,r+10),!0):this.dataSource.next().then(function(e){t.populateItems(e,!1)})}},{key:"populateItems",value:function(e,s){for(var i=this.itemsCacheData.length,a=this.lastPhysicalItemIndex+1,r=0;r<e.length;r+=1){this.loadingItems[r]&&this.loadingItems[r].classList.add("invisible");var n=(a+r)%t,l=this.physicalItems[n]&&this.physicalItems.length===t,h=l?this.dataSource.render(e[r],this.physicalItems[n]):this.dataSource.render(e[r]);h.style.position="absolute",h.style.transform="translateY("+this.lastPhysicalItemTranslateY+"px)",h.style.width="92%",h.dataset.translateY=this.lastPhysicalItemTranslateY,l||this.scroller.appendChild(h),s||(this.scrollRunwayEnd+=h.offsetHeight+10),this.lastPhysicalItemTranslateY+=h.offsetHeight+10,this.physicalItems[n]=h,this.itemsCacheData[i+r]=e[r]}this.calculatePhysicalItemsIndex(e.length),this.scrollRunway.style.transform="translate(0,"+this.scrollRunwayEnd+"px)",this.requestInProgress=!1,this.count+=1}},{key:"loadItemsUp",value:function(){this.requestInProgress=!0;for(var e=this.firstPhysicalItemIndex%t,s=++this.physicalItems[e].dataset.translateY-(this.loadingItemHeight+10),i=9;i>=0;i-=1){var a=this.loadingItems[i],r=a?this.loadingItems[i]:this.dataSource.createLoadingElement();this.loadingItems[i]=r,r.style.position="absolute",r.style.transform="translateY("+s+"px)",r.style.width="92%",r.classList.remove("invisible"),a||this.scroller.appendChild(r),s-=this.loadingItemHeight+10}this.populateItemsTop()}},{key:"populateItemsTop",value:function(){for(var e=this.firstPhysicalItemIndex%t,s=(++this.physicalItems[e].dataset.translateY,this.physicalItems[e].offsetHeight,this.firstPhysicalItemIndex-1),i=s;i>s-10;i-=1){this.loadingItems[i%10]&&this.loadingItems[i%10].classList.add("invisible");var a=i%t;console.log("Reusbale last index: ",this.lastPhysicalItemIndex),console.log("Reusable index: ",a);var r=this.physicalItems[a]&&this.physicalItems.length===t,n=r?this.dataSource.render(this.itemsCacheData[i],this.physicalItems[a]):this.dataSource.render(this.itemsCacheData[i]);n.style.position="absolute",n.style.transform="translateY("+this.firstPhysicalItemTranslateY+"px)",n.style.width="92%",n.dataset.translateY=this.firstPhysicalItemTranslateY,r||this.scroller.appendChild(n),this.firstPhysicalItemTranslateY-=n.offsetHeight+10,console.log("TranslateY: ",this.firstPhysicalItemTranslateY),this.physicalItems[a]=n}this.calculatePhysicalItemsIndex(-10),this.requestInProgress=!1}},{key:"calculatePhysicalItemsIndex",value:function(e){this.lastPhysicalItemIndex+=e,this.firstPhysicalItemIndex=Math.max(0,this.lastPhysicalItemIndex-(t-1)),this.middlePhysicalItemIndex=this.firstPhysicalItemIndex+(this.lastPhysicalItemIndex-this.firstPhysicalItemIndex+1)/2;var s=this.physicalItems[this.lastPhysicalItemIndex%t],i=this.physicalItems[this.firstPhysicalItemIndex%t];this.firstPhysicalItem=this.physicalItems[this.firstPhysicalItemIndex%t],this.lastPhysicalItem=this.physicalItems[this.lastPhysicalItemIndex%t],this.lastPhysicalItemTranslateY=parseInt(s.dataset.translateY,10)+(s.offsetHeight+10),this.firstPhysicalItemTranslateY=parseInt(i.dataset.translateY,10)-(i.offsetHeight+10)}},{key:"onTouchStart",value:function(t){var e=this;this.target||t.target.classList.contains("scroller__item")&&(this.target=t.target,this.targetBCR=this.target.getBoundingClientRect(),this.startX=t.touches[0].pageX,this.currentX=this.startX,this.draggingItem=!0,this.target.style.willChange="transform",requestAnimationFrame(function(){return e.update()}))}},{key:"onTouchMove",value:function(t){this.target&&(this.currentX=t.touches[0].pageX)}},{key:"onTouchEnd",value:function(t){if(this.target){this.targetX=0;var e=this.currentX-this.startX,s=.35*this.targetBCR.width;Math.abs(e)>s&&(this.targetX=e>0?this.targetBCR.width:-this.targetBCR.width),this.draggingItem=!1}}},{key:"update",value:function(){var t=this;if(requestAnimationFrame(function(){return t.update()}),this.target){this.draggingItem?this.translateX=this.currentX-this.startX:this.translateX+=(this.targetX-this.translateX)/4;var e=Math.abs(this.translateX)/this.targetBCR.width,s=1-Math.pow(e,3);if(this.target.style.transform="translate("+this.translateX+"px, "+this.target.dataset.translateY+"px)",this.target.style.opacity=s,!this.draggingItem){var i=Math.abs(this.translateX)<.01;if(s<.01){if(!this.target||!this.target.parentNode)return;this.scrollRunwayEnd-=this.target.offsetHeight+10,this.scrollRunway.style.transform="translate(0,"+this.scrollRunwayEnd+"px)",this.scroller.removeChild(this.target);var a=this.virtualItems.indexOf(this.target);this.items.splice(a,1),this.animateOtherItemsIntoPosition(a)}else i&&this.resetTarget()}}}},{key:"animateOtherItemsIntoPosition",value:function(t){var e=this;if(t===this.items.length)return void this.resetTarget();for(var s=function t(s){var i=s.target;i.removeEventListener("transitionend",t),i.style.transition="",e.resetTarget()},i=t;i<this.virtualItems.length;i+=1){var a=this.virtualItems[i];a.style.transform="translateY("+a.dataset.translateY+"px)",a.addEventListener("transitionend",function(t){return s(t)})}requestAnimationFrame(function(s){for(var i=t;i<e.virtualItems.length;i+=1){var a=e.virtualItems[i];a.style.transition="transform 150ms cubic-bezier(0,0,0.31,1)",console.log("targetBCRheight: ",e.targetBCR.height),a.style.transform="translateY("+(parseInt(a.dataset.translateY,10)-e.targetBCR.height-10)+"px)",a.dataset.translateY=parseInt(a.dataset.translateY,10)-e.targetBCR.height-10}})}},{key:"resetTarget",value:function(){this.target&&(this.target.style.willChange="initial",this.target.style.transform="translateY("+this.target.dataset.translateY+"px)",this.target=null)}}]),s}()});var _createClass=function(){function t(t,e){for(var s=0;s<e.length;s++){var i=e[s];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,s,i){return s&&t(e.prototype,s),i&&t(e,i),e}}();define("components/infinite-scroller-v2",[],function(){return function(){function t(e,s,i){_classCallCheck(this,t),this.scroller=e,this.dataSource=s,this.anchorScrollTop=0,this.loadingItemHeight=0,this.loadingItemWidth=0,this.loadingItems=[],this.firstAttachedItem=0,this.lastAttachedItem=0,this.virtualItems=[],this.physicalItems=[],this.virtualItemsCount=0,this.physicalItemsCount=0,this.items=[],this.loadedItems=0,this.requestInProgress=!1,this.swipeable=i.swipeable,this.target=null,this.targetBCR=null,this.targetX=0,this.startX=0,this.currentX=0,this.translateX=0,this.draggingItem=!1,this.anchorItem=document.createElement("div"),this.anchorItemHeight=0,this.anchorItem.style.height="1px",this.anchorItem.style.width="1px",this.scroller.appendChild(this.anchorItem),this.scrollRunway=document.createElement("div"),this.scrollRunwayEndBefore=0,this.scrollRunwayEnd=0,this.scrollRunway.style.position="absolute",this.scrollRunway.style.height="1px",this.scrollRunway.style.width="1px",this.scrollRunway.style.transition="transform 0.2s",this.scroller.appendChild(this.scrollRunway),this.previousScrollTop=0,this.addEventListeners(),this.count=0,this.loadItemsExp(!1)}return _createClass(t,[{key:"addEventListeners",value:function(){var t=this;window.addEventListener("resize",function(e){return t.onResize(e)}),this.scroller.addEventListener("scroll",function(e){return t.onScroll(e)}),this.swipeable&&(this.scroller.addEventListener("touchstart",function(e){return t.onTouchStart(e)}),this.scroller.addEventListener("touchmove",function(e){return t.onTouchMove(e)}),this.scroller.addEventListener("touchend",function(e){return t.onTouchEnd(e)}))}},{key:"loadItems",value:function(){var t=this;this.requestInProgress=!0;for(var e=0;e<10;e+=1){var s=this.dataSource.createLoadingElement();this.loadingItems[e]=s,this.scroller.appendChild(s)}this.dataSource.next().then(function(e){return t.populateItems(e),t.dataSource.next()})}},{key:"loadItemsExp",value:function(t){var e=this;if(!(this.count>15)){this.requestInProgress=!0;for(var s=this.scrollRunwayEnd,i=0;i<10;i+=1){var a=this.loadingItems[i],r=a?this.loadingItems[i]:this.dataSource.createLoadingElement();this.loadingItems[i]=r,r.style.position="absolute",r.style.transform="translateY("+s+"px)",r.style.width="92%",r.classList.remove("invisible"),a||this.scroller.appendChild(r),s+=r.offsetHeight+10}if(t){console.log("first load");var n=[];this.dataSource.next().then(function(t){return n=n.concat(t),e.dataSource.next()}).then(function(t){n=n.concat(t),e.populateItemsExp(n)})}else this.dataSource.next().then(function(t){e.populateItemsExp(t)})}}},{key:"populateItems",value:function(t){for(var e=0;e<t.length;e+=1){this.loadingItems[0]&&(this.scroller.removeChild(this.loadingItems[0]),this.loadingItems.splice(0,1));var s=this.dataSource.render(t[e]);this.scroller.appendChild(s),this.scrollRunwayEnd+=s.offsetHeight+10,this.items.push(s)}this.scrollRunway.style.transform="translate(0,"+this.scrollRunwayEnd+"px)",this.requestInProgress=!1}},{key:"populateItemsExp",value:function(t){console.log("Hello");for(var e=0;e<t.length;e+=1){this.loadingItems[e]&&this.loadingItems[e].classList.add("invisible");var s=(this.firstAttachedItem+e)%20,i=this.virtualItems[s]&&20===this.virtualItems.length,a=i?this.dataSource.render(t[e],this.virtualItems[s]):this.dataSource.render(t[e]);a.style.position="absolute",a.style.transform="translateY("+this.scrollRunwayEnd+"px)",a.style.width="92%",i||this.scroller.appendChild(a),this.scrollRunwayEnd+=a.offsetHeight+10,this.virtualItems[s]=a,this.items.push(a)}this.lastAttachedItem=this.firstAttachedItem+(t.length-1),this.scrollRunway.style.transform="translate(0,"+this.scrollRunwayEnd+"px)",this.requestInProgress=!1,this.count+=1}},{key:"onResize",value:function(t){var e=this.dataSource.createLoadingElement();this.scroller.appendChild(e),this.loadingItemHeight=e.offsetHeight,this.loadingItemWidth=e.offsetWidth,this.scroller.removeChild(e);for(var s=0;s<this.items.length;s+=1)this.items[s].height=this.items[s].width=0;this.onScroll()}},{key:"onScroll",value:function(t){var e=this.scroller.scrollTop-this.previousScrollTop;if(this.previousScrollTop=this.scroller.scrollTop,e>0){var s=this.scroller.scrollTop+this.scroller.offsetHeight+200;!this.requestInProgress&&s>this.scroller.scrollHeight&&(this.firstAttachedItem=this.lastAttachedItem+1,this.loadItemsExp())}}},{key:"fill",value:function(t,e){this.firstAttachedItem=Math.max(0,t),this.lastAttachedItem=e,this.attachContent()}},{key:"getLoadingItem",value:function(){var t=this.loadingItems.pop();return t||this.dataSource.createLoadingElement()}},{key:"attachContent",value:function(t,e){}},{key:"addItem",value:function(){this.items.push({data:null,node:null})}},{key:"addContent",value:function(t){this.requestInProgress=!1;for(var e=0;e<t.length;e+=1)this.addItem(),this.items[this.loadedItems++].data=t[e];this.attachContent()}},{key:"onTouchStart",value:function(t){var e=this;this.target||t.target.classList.contains("scroller__item")&&(this.target=t.target,this.targetBCR=this.target.getBoundingClientRect(),this.startX=t.touches[0].pageX,this.currentX=this.startX,this.draggingItem=!0,this.target.style.willChange="transform",requestAnimationFrame(function(){return e.update()}))}},{key:"onTouchMove",value:function(t){this.target&&(this.currentX=t.touches[0].pageX)}},{key:"onTouchEnd",value:function(t){if(this.target){this.targetX=0;var e=this.currentX-this.startX,s=.35*this.targetBCR.width;Math.abs(e)>s&&(this.targetX=e>0?this.targetBCR.width:-this.targetBCR.width),this.draggingItem=!1}}},{key:"update",value:function(){var t=this;if(requestAnimationFrame(function(){return t.update()}),this.target){this.draggingItem?this.translateX=this.currentX-this.startX:this.translateX+=(this.targetX-this.translateX)/4;var e=Math.abs(this.translateX)/this.targetBCR.width,s=1-Math.pow(e,3);if(this.target.style.transform="translateX("+this.translateX+"px)",this.target.style.opacity=s,!this.draggingItem){var i=Math.abs(this.translateX)<.01;if(s<.01){if(!this.target||!this.target.parentNode)return;this.scrollRunwayEnd-=this.target.offsetHeight+10,this.scrollRunway.style.transform="translate(0,"+this.scrollRunwayEnd+"px)",this.scroller.removeChild(this.target);var a=this.items.indexOf(this.target);this.items.splice(a,1),this.animateOtherItemsIntoPosition(a),this.items.length<6&&this.loadItems()}else i&&this.resetTarget()}}}},{key:"animateOtherItemsIntoPosition",value:function(t){var e=this;if(t===this.items.length)return void this.resetTarget();for(var s=function t(s){var i=s.target;i.removeEventListener("transitionend",t),i.style.transition="",i.style.transform="",e.resetTarget()},i=t;i<this.items.length;i+=1){var a=this.items[i];a.style.transform="translateY("+(this.targetBCR.height+10)+"px)",a.addEventListener("transitionend",function(t){return s(t)})}requestAnimationFrame(function(s){for(var i=t;i<e.items.length;i+=1){var a=e.items[i];a.style.transition="transform 150ms cubic-bezier(0,0,0.31,1)",a.style.transform=""}})}},{key:"resetTarget",value:function(){this.target&&(this.target.style.willChange="initial",this.target.style.transform="none",this.target=null)}}]),t}()});var _createClass=function(){function t(t,e){for(var s=0;s<e.length;s++){var i=e[s];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,s,i){return s&&t(e.prototype,s),i&&t(e,i),e}}();define("components/infinite-scroller",[],function(){return function(){function t(e,s,i){_classCallCheck(this,t),this.scroller=e,this.dataSource=s,this.anchorScrollTop=0,this.loadingItemHeight=0,this.loadingItemWidth=0,this.loadingItems=[],this.firstAttachedItem=0,this.lastAttachedItem=0,this.virtualItems=[],this.physicalItems=[],this.virtualItemsCount=0,this.physicalItemsCount=0,this.items=[],this.itemsData=[],this.loadedItems=0,this.requestInProgress=!1,this.swipeable=i.swipeable,this.target=null,this.targetBCR=null,this.targetX=0,this.startX=0,this.currentX=0,this.translateX=0,this.draggingItem=!1,this.anchorItem=document.createElement("div"),this.anchorItemHeight=0,this.anchorItem.style.height="0px",this.anchorItem.style.width="1px",this.scroller.appendChild(this.anchorItem),this.scrollRunway=document.createElement("div"),this.scrollRunwayEndBefore=0,this.scrollRunwayEnd=0,this.scrollRunway.style.position="absolute",this.scrollRunway.style.height="1px",this.scrollRunway.style.width="1px",this.scrollRunway.style.transition="transform 0.2s",this.scroller.appendChild(this.scrollRunway),this.previousScrollTop=0,this.addEventListeners(),this.count=0,this.loadItems()}return _createClass(t,[{key:"addEventListeners",value:function(){var t=this;window.addEventListener("resize",function(e){return t.onResize(e)}),this.scroller.addEventListener("scroll",function(e){return t.onScroll(e)}),this.swipeable&&(this.scroller.addEventListener("touchstart",function(e){return t.onTouchStart(e)}),this.scroller.addEventListener("touchmove",function(e){return t.onTouchMove(e)}),this.scroller.addEventListener("touchend",function(e){return t.onTouchEnd(e)}))}},{key:"loadItems",value:function(){var t=this;if(!(this.count>15)){this.requestInProgress=!0;for(var e=0;e<10;e+=1){var s=this.dataSource.createLoadingElement();this.loadingItems[e]=s,this.scroller.appendChild(s)}this.dataSource.next().then(function(e){t.populateItems(e)})}}},{key:"populateItems",value:function(t){for(var e=0;e<t.length;e+=1){this.loadingItems[0]&&(this.scroller.removeChild(this.loadingItems[0]),this.loadingItems.splice(0,1));var s=this.dataSource.render(t[e]);this.scroller.appendChild(s),this.scrollRunwayEnd+=s.offsetHeight+10,this.items.push(s)}this.scrollRunway.style.transform="translate(0,"+this.scrollRunwayEnd+"px)",this.requestInProgress=!1,this.count+=1}},{key:"onResize",value:function(t){var e=this.dataSource.createLoadingElement();this.scroller.appendChild(e),this.loadingItemHeight=e.offsetHeight,this.loadingItemWidth=e.offsetWidth,this.scroller.removeChild(e);for(var s=0;s<this.items.length;s+=1)this.items[s].height=this.items[s].width=0;this.onScroll()}},{key:"onScroll",value:function(t){var e=this.scroller.scrollTop-this.previousScrollTop;if(this.previousScrollTop=this.scroller.scrollTop,e>0){var s=this.scroller.scrollTop+this.scroller.offsetHeight+200;!this.requestInProgress&&s>this.scroller.scrollHeight&&(this.firstAttachedItem=this.lastAttachedItem+1,this.loadItems())}}},{key:"fill",value:function(t,e){this.firstAttachedItem=Math.max(0,t),this.lastAttachedItem=e,this.attachContent()}},{key:"getLoadingItem",value:function(){var t=this.loadingItems.pop();return t||this.dataSource.createLoadingElement()}},{key:"attachContent",value:function(t,e){}},{key:"addItem",value:function(){this.items.push({data:null,node:null})}},{key:"addContent",value:function(t){this.requestInProgress=!1;for(var e=0;e<t.length;e+=1)this.addItem(),this.items[this.loadedItems++].data=t[e];this.attachContent()}},{key:"onTouchStart",value:function(t){var e=this;this.target||t.target.classList.contains("scroller__item")&&(this.target=t.target,this.targetBCR=this.target.getBoundingClientRect(),this.startX=t.touches[0].pageX,this.currentX=this.startX,this.draggingItem=!0,this.target.style.willChange="transform",requestAnimationFrame(function(){return e.update()}))}},{key:"onTouchMove",value:function(t){this.target&&(this.currentX=t.touches[0].pageX)}},{key:"onTouchEnd",value:function(t){if(this.target){this.targetX=0;var e=this.currentX-this.startX,s=.35*this.targetBCR.width;Math.abs(e)>s&&(this.targetX=e>0?this.targetBCR.width:-this.targetBCR.width),this.draggingItem=!1}}},{key:"update",value:function(){var t=this;if(requestAnimationFrame(function(){return t.update()}),this.target){this.draggingItem?this.translateX=this.currentX-this.startX:this.translateX+=(this.targetX-this.translateX)/4;var e=Math.abs(this.translateX)/this.targetBCR.width,s=1-Math.pow(e,3);if(this.target.style.transform="translateX("+this.translateX+"px)",this.target.style.opacity=s,!this.draggingItem){var i=Math.abs(this.translateX)<.01;if(s<.01){if(!this.target||!this.target.parentNode)return;this.scrollRunwayEnd-=this.target.offsetHeight+10,this.scrollRunway.style.transform="translate(0,"+this.scrollRunwayEnd+"px)",this.scroller.removeChild(this.target);var a=this.items.indexOf(this.target);this.items.splice(a,1),this.animateOtherItemsIntoPosition(a),this.items.length<6&&this.loadItems()}else i&&this.resetTarget()}}}},{key:"animateOtherItemsIntoPosition",value:function(t){var e=this;if(t===this.items.length)return void this.resetTarget();for(var s=function t(s){var i=s.target;i.removeEventListener("transitionend",t),i.style.transition="",i.style.transform="",e.resetTarget()},i=t;i<this.items.length;i+=1){var a=this.items[i];a.style.transform="translateY("+(this.targetBCR.height+10)+"px)",a.addEventListener("transitionend",function(t){return s(t)})}requestAnimationFrame(function(s){for(var i=t;i<e.items.length;i+=1){var a=e.items[i];a.style.transition="transform 150ms cubic-bezier(0,0,0.31,1)",a.style.transform=""}})}},{key:"resetTarget",value:function(){this.target&&(this.target.style.willChange="initial",this.target.style.transform="none",this.target=null)}}]),t}()});var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_createClass=function(){function t(t,e){for(var s=0;s<e.length;s++){var i=e[s];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,s,i){return s&&t(e.prototype,s),i&&t(e,i),e}}();define("datasource/messages",[],function(){return function(){function t(e){_classCallCheck(this,t),this.loadingTemplate=document.querySelector("#templates .scroller__item--loading"),this.messageTemplate=document.querySelector("#templates .scroller__item"),this.url=e.url,this.dataEndpoint=e.dataEndpoint,this.dataUrl=""+this.url+this.dataEndpoint,this.nextItem=0,this.nextPageToken=null}return _createClass(t,[{key:"fetch",value:function(t){return new Promise(function(e,s){var i=t.params;i&&"object"===(void 0===i?"undefined":_typeof(i))&&(i=Object.keys(i).map(function(t){return encodeURIComponent(t)+"="+encodeURIComponent(i[t])}).join("&"));var a=i?t.url+"?"+i:t.url,r=new XMLHttpRequest;r.open(t.method||"GET",a),r.onload=function(){r.status>=200&&r.status<300?e(r.response):s(r.statusText)},r.onerror=function(){s(r.statusText)},r.send()})}},{key:"next",value:function(){var t=this,e={method:"GET",url:this.dataUrl};return this.nextPageToken&&(e.params={pageToken:this.nextPageToken}),this.fetch(e).then(function(e){var s=JSON.parse(e);return t.nextPageToken=s.pageToken,s.messages})}},{key:"createLoadingElement",value:function(){return this.loadingTemplate.cloneNode(!0)}},{key:"render",value:function(t,e){return e=e||this.messageTemplate.cloneNode(!0),e.dataset.id=t.id,e.querySelector(".card__avatar").src=""+this.url+t.author.photoUrl,e.querySelector(".card__title").textContent=t.author.name,e.querySelector(".card__subtitle").textContent=this.timeSince(new Date(t.updated)),e.querySelector(".card__content").textContent=t.content,e}},{key:"timeSince",value:function(t){"object"!==(void 0===t?"undefined":_typeof(t))&&(t=new Date(t));var e=Math.floor((new Date-t)/1e3),s=Math.floor(e/31536e3);return s>=1?s+" year"+(s>1?"s":"")+" ago":(s=Math.floor(e/2592e3))>=1?s+" month"+(s>1?"s":"")+" ago":(s=Math.floor(e/86400))>=1?s+" day"+(s>1?"s":"")+" ago":(s=Math.floor(e/3600))>=1?s+" hour"+(s>1?"s":"")+" ago":(s=Math.floor(e/3600),s>=1?s+" minute"+(s>1?"s":"")+" ago":s+" second"+(s>1?"s":"")+" ago")}}]),t}()});
//# sourceMappingURL=main.min.js.map
